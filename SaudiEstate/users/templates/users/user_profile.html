{% extends "base.html" %}
{% load static %}

{% block title %}My Profile{% endblock %}

{% block content %}

<div class="profile-wrapper">

    <aside class="profile-card">

        <div class="profile-img-box">
            {% if user.profile_image %}
            <img src="{{ user.profile_image.url }}" alt="Profile" class="profile-photo">
            {% else %}
            <span class="material-icons-outlined default-avatar">account_circle</span>
            {% endif %}
        </div>

        <h2 class="profile-name">{{ user.first_name }} {{ user.last_name }}</h2>
        <p class="profile-username">@{{ user.username }}</p>

        <div class="info-list">
            <p><span class="material-icons-outlined">location</span> {{ user.city|default:"—" }}</p>
            <p><span class="material-icons-outlined">call</span> {{ user.phone_number|default:"—" }}</p>
            <p><span class="material-icons-outlined">mail</span> {{ user.email }}</p>
            <p><span class="material-icons-outlined">badge</span> {{ user.national_id|default:"—" }}</p>
        </div>

        <a href="{% url 'users:edit_profile' %}" class="edit-btn">
            <span class="material-icons-outlined"></span> Edit Profile
        </a>

    </aside>


    <main class="profile-content">

        <section class="section-box">
            <h3 class="section-title"><span class="material-icons-outlined section-icon">home</span> My Listed
                Properties</h3>

            {% if my_properties %}
            <div class="grid-cards">
                {% for property in my_properties %}
                {% include 'properties/card.html' %}
                {% endfor %}
            </div>
            {% else %}
            <p class="empty">You haven't listed any properties yet.</p>
            {% endif %}
        </section>


        <section class="section-box">
            <h3 class="section-title"><span class="material-icons-outlined section-icon">favorite</span> Favorite
                Properties</h3>

            {% if favorites %}
            <div class="grid-cards">
                {% for fav in favorites %}
                {% include 'properties/card.html' with property=fav.property %}
                {% endfor %}
            </div>
            {% else %}
            <p class="empty">No favorites added.</p>
            {% endif %}
        </section>


        <section class="section-box">
            <h3 class="section-title"><span class="material-icons-outlined section-icon">event</span> Visit Requests
            </h3>

            {% if visit_requests %}
            <table class="profile-table">
                <thead>
                    <tr>
                        <th>Property</th>
                        <th>Date</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for req in visit_requests %}
                    <tr>
                        <td>{{ req.property.title }}</td>
                        <td>{{ req.preferred_date }}</td>
                        <td class="status {{ req.status }}">{{ req.status|title }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p class="empty">No visit requests yet.</p>
            {% endif %}
        </section>


        <section class="section-box">
            <h3 class="section-title"><span class="material-icons-outlined section-icon">sms</span> My Inquiries</h3>

            {% if inquiries %}
            <div class="inquiry-list">
                {% for q in inquiries %}
                <div class="inquiry-item">
                    <h4>{{ q.property.title }}</h4>
                    <p>{{ q.message }}</p>
                    <span class="inquiry-date">{{ q.created_at|date:"M d, Y" }}</span>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <p class="empty">You haven't sent any inquiries.</p>
            {% endif %}
        </section>


        <section class="section-box">
            <h3 class="section-title">
                <span class="material-icons-outlined section-icon">mail</span>
                Received Inquiries
            </h3>

            {% if received_inquiries %}
            <div class="inquiry-list">
                {% for q in received_inquiries %}
                <div class="inquiry-item">
                    <h4>{{ q.property.title }}</h4>
                    <p>{{ q.message }}</p>
                    <span class="inquiry-date">{{ q.created_at|date:"M d, Y" }}</span>
                    <p class="from-user">From: {{ q.sender.username }}</p>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <p class="empty">No inquiries received yet.</p>
            {% endif %}
        </section>


    </main>
</div>

{% endblock %}